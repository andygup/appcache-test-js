//>>built
require({cache:{"url:esri/dijit/GeocodeReview/templates/Review.html":'\x3cdiv style\x3d"width:100%; height:100%;"\x3e\n\x3cdiv data-dojo-attach-point\x3d"_bcWrapper" style\x3d"width: 100%; height: 100%;"\x3e\n\t\x3cdiv data-dojo-attach-point\x3d"_BorderContainerNode" dojotype\x3d"dijit.layout.BorderContainer" gutters\x3d"false"  style\x3d"width: 100%; height: 100%;"\x3e\n\t\t\x3cdiv class\x3d"esri_scWrapper" data-dojo-attach-point\x3d"_StackControllerWrapper" class\x3d"edgePanel" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'top\'" style\x3d"height:36px;"\x3e\n\t\t\t\x3cdiv id\x3d"stackController" data-dojo-attach-point\x3d"_StackControllerNode" data-dojo-type\x3d"dijit.layout.StackController" data-dojo-props\x3d"containerId:\'stackContainer\'" \x3e\x3c/div\x3e\n\t\t\x3c/div\x3e\t\n\t\t\x3cdiv data-dojo-attach-point\x3d"_GridWrapper" class\x3d"esri_gridWrapper" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'center\'"\x3e\t\n\t\t\t\x3cdiv id\x3d"stackContainer" data-dojo-attach-point\x3d"_StackContainerNode" data-dojo-type\x3d"dijit/layout/StackContainer"  data-dojo-id\x3d"stackContainer"\x3e\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_tab1Node" data-dojo-type\x3d"dijit/layout/ContentPane" title\x3d"Unmatched (-)"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"esri_GeocodeGrid" data-dojo-attach-point\x3d"_grid1Node"\x3e\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv  data-dojo-attach-point\x3d"_tab2Node"  data-dojo-type\x3d"dijit/layout/ContentPane" title\x3d"Matched (-)"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"esri_GeocodeGrid" data-dojo-attach-point\x3d"_grid2Node"\x3e\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv  data-dojo-attach-point\x3d"_tab3Node"  data-dojo-type\x3d"dijit/layout/ContentPane" title\x3d"Reviewed (-)"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"esri_GeocodeGrid" data-dojo-attach-point\x3d"_grid3Node"\x3e\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n'}});
define("esri/dijit/GeocodeReview","dojo/dom dojo/dom-construct dojo/dom-style dojo/on dojo/parser dojo/ready dojo/Evented dojo/uacss dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dijit/registry dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/layout/BorderContainer dijit/layout/ContentPane dijit/layout/StackContainer dijit/layout/StackController dojo/text!esri/dijit/GeocodeReview/templates/Review.html dgrid/Grid dgrid/OnDemandGrid dgrid/Selection dgrid/Keyboard dgrid/editor dgrid/extensions/DijitRegistry dgrid/extensions/ColumnHider dgrid/extensions/Pagination dojo/store/Memory esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/tasks/query esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/request esri/arcgis/utils esri/kernel".split(" "),
function(h,I,J,e,K,L,s,t,M,k,b,N,O,u,v,w,x,P,Q,R,S,T,y,U,z,A,B,m,C,D,V,f,l,W,E,n,p,g,F,G,q,H){h=k([u,v,w,x,s],{baseClass:"ReviewWidgetBase",loaded:!1,templateString:y,widgetsInTemplate:!0,constructor:function(a,c){k.safeMixin(this,a);this.StandardGrid=k([C,z,A,B,m,D]);this._generateStores();this._generateDefaultColumns()},postCreate:function(){this.inherited(arguments);this._generateUnmatchedGrid();this._generateMatchedGrid();this._generateReviewedGrid();this.graphicsLayer=new F;this.map.addLayer(this.graphicsLayer);
this._listenerHandles=[e(this._StackControllerNode,"click",b.hitch(this,function(a){this._gridUnmatchedRef.clearSelection();this._gridMatchedRef.clearSelection();this._gridReviewedRef.clearSelection();this.currentTab=this._StackContainerNode.selectedChildWidget;this.currentTabId=this._StackContainerNode.selectedChildWidget.id;this._resizeGrids()})),e(this._gridUnmatchedRef,"dgrid-select",b.hitch(this,function(a){this.currentSelectedRow=this._unmatchedStore.get(a.rows[0].data[this._tableLayer.objectIdField]);
this._selectGridRowEvent(a.rows[0].data[this._tableLayer.objectIdField],this._unmatchedStore.get(a.rows[0].data[this._tableLayer.objectIdField]))})),e(this._gridMatchedRef,"dgrid-select",b.hitch(this,function(a){this.currentSelectedRow=this._matchedStore.get(a.rows[0].data[this._featureLayer.objectIdField]);this._selectGridRowEvent(a.rows[0].data[this._featureLayer.objectIdField],this._matchedStore.get(a.rows[0].data[this._featureLayer.objectIdField]))})),e(this._gridMatchedRef,"dgrid-datachange",
b.hitch(this,function(a){var c=null;this._matchedStore.get(a.cell.row.id).updated=!0;this._matchedStore.get(a.cell.row.id)[a.cell.column.field]=a.value;this._matchedStore.get(a.cell.row.id).location&&(c=this._matchedStore.get(a.cell.row.id).location);this._emitDataChange(a.value,a.oldValue,c);this._applyAddressEdits(this._matchedStore.get(a.cell.row.id))})),e(this._gridUnmatchedRef,"dgrid-datachange",b.hitch(this,function(a){var c=null;this._unmatchedStore.get(a.cell.row.id).updated=!0;this._unmatchedStore.get(a.cell.row.id)[a.cell.column.field]=
a.value;this._unmatchedStore.get(a.cell.row.id).location&&(c=this._unmatchedStore.get(a.cell.row.id).location);this._emitDataChange(a.value,a.oldValue,c);this._applyAddressEdits(this._unmatchedStore.get(a.cell.row.id))}))]},startup:function(){this.inherited(arguments);this.domNode&&this.map&&(this.map.loaded?this._init():e(this.map,"load",b.hitch(this,function(){this._init()})))},_init:function(){this.loaded=!0;this.emit("load",{});q.arcgisUrl="http://devext.arcgis.com/sharing/content/items";q.getItem(this.itemid).then(b.hitch(this,
function(a){this._initFS(a.item.item)}),function(a){})},_emitDataChange:function(a,c,d){this.emit("esri-datachange",{newAddress:a,oldAddress:c,location:d})},_applyEdits:function(a){var c=new l;c.attributes=a;"unmatched"===a.defaultState?(this._tableLayer.applyEdits(null,null,[c]).then(function(a,c,b){}),c.geometry=a.location,this._featureLayer.applyEdits([c],null,null).then(function(a,c,b){})):"matched"===a.defaultState&&(c.geometry=a.location,this._featureLayer.applyEdits(null,[c],null).then(function(a,
c,b){}))},_applyAddressEdits:function(a){var c=new l;c.attributes=a;"unmatched"===a.defaultState?this._tableLayer.applyEdits(null,[c],null).then(function(a,c,b){}):this._featureLayer.applyEdits(null,[c],null).then(function(a,c,b){})},_selectGridRowEvent:function(a,c){this.emit("esri-row-select",{id:a,address:c[this._test_addressKeyword],location:c.location,defaultState:c.defaultState,reviewed:c.reviewed,updated:c.updated})},matchFeature:function(a){var c=this.currentSelectedRow;c.location=a.location;
this._applyEdits(c);this._reviewedArray.push({id:this._reviewedArray.length,oldAddress:this.currentSelectedRow[this._test_addressKeyword],newAddress:a.address,oldLocation:this.currentSelectedRow.location,newLocation:a.location});this._reviewedStore=new f({data:this._reviewedArray,idProperty:"id"});this._gridReviewedRef.set("store",this._reviewedStore)},_drawFeature:function(a){var c=a.location,d=this.map;d._layers[this.graphicsLayer.id].graphics.forEach(b.hitch(this,function(a){d._layers[this.graphicsLayer.id].remove(a);
d.infoWindow&&d.infoWindow.hide()}));this.map.centerAt(c).then(b.hitch(this,function(){var b=(new n).setStyle(n.STYLE_CIRCLE).setColor("#5FFB17"),b=new l(c,b);d.infoWindow.setTitle("Match");d.infoWindow.setContent(a[this._test_addressKeyword]);d.infoWindow.show(c);d._layers[this.graphicsLayer.id].add(b)}))},_initFS:function(a){G({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback",load:b.hitch(this,function(c,d){0!==c.layers.length&&(this._featureLayer=new g(a+"/0",{mode:g.MODE_SELECTION,
outFields:["*"]}),this._listenerHandles.push(this._layerLoad()));0!==c.tables.length&&(this._tableLayer=new g(a+"/1",{mode:g.MODE_SELECTION,outFields:["*"]}),this._listenerHandles.push(this._tableLoad()));this._test_addressKeyword="SITEADDRESS";this._test_streetKeyword="Street";this._test_cityKeyword="City";this._test_stateKeyword="State"})})},_layerLoad:function(){return e(this._featureLayer,"load",b.hitch(this,function(a){this._featureLayerQuery()}))},_tableLoad:function(){return e(this._tableLayer,
"load",b.hitch(this,function(a){this._tableLayerQuery()}))},_featureLayerQuery:function(){var a,c,d,e=[],r=new p;r.where="1 \x3d 1";this._featureLayer.queryFeatures(r).then(b.hitch(this,function(b){this._setTabText(this._tab2Node,"Matched",b.features.length);for(a=0;a<b.features.length;a++)b.features[a].attributes.updated=!1,b.features[a].attributes.reviewed=!1,b.features[a].attributes.defaultState="matched",d=b.features[a].attributes,c=new E(b.features[a].geometry.getLongitude(),b.features[a].geometry.getLatitude()),
d.location=c,e.push(d);this._gridMatchedRef.set("columns",this._generateDynamicColumns(b));this._matchedStore=new f({data:e,idProperty:this._featureLayer.objectIdField});this._gridMatchedRef.set("store",this._matchedStore)}))},_tableLayerQuery:function(){var a,c,d=[],e=new p;e.where="1 \x3d 1";this._tableLayer.queryFeatures(e).then(b.hitch(this,function(b){this._setTabText(this._tab1Node,"Unmatched",b.features.length);for(a=0;a<b.features.length;a++)b.features[a].attributes.updated=!1,b.features[a].attributes.reviewed=
!1,b.features[a].attributes.defaultState="unmatched",c=b.features[a].attributes,d.push(c);this._gridUnmatchedRef.set("columns",this._generateDynamicColumns(b));this._unmatchedStore=new f({data:d,idProperty:this._tableLayer.objectIdField});this._gridUnmatchedRef.set("store",this._unmatchedStore)}))},_setTabText:function(a,c,b){a.set("title",c+" ("+b+" Total)")},_generateUnmatchedGrid:function(){this._gridUnmatchedRef=new this.StandardGrid({store:this._unmatchedStore,columns:this._unmatchedColumns,
noDataMessage:"No Unmatched Features",selectionMode:"extended",allowSelectAll:!1,cellNavigation:!1,sort:[{attribute:"address",descending:!0}]},this._grid1Node);this._gridUnmatchedRef.startup();this._gridUnmatchedRef.resize()},_generateMatchedGrid:function(){this._gridMatchedRef=new this.StandardGrid({store:this._matchedStore,columns:this._matchedColumns,noDataMessage:"No Matched Features",selectionMode:"extended",allowSelectAll:!1,cellNavigation:!1,sort:[{attribute:"address_old",descending:!0}]},
this._grid2Node);this._gridMatchedRef.startup();this._gridMatchedRef.resize()},_generateReviewedGrid:function(){this._gridReviewedRef=new this.StandardGrid({store:this._reviewedStore,columns:this._reviewedColumns,noDataMessage:"No Reviewed Features",selectionMode:"extended",allowSelectAll:!1,cellNavigation:!1},this._grid3Node);this._gridReviewedRef.startup();this._gridReviewedRef.resize()},_resizeGrids:function(){this._gridUnmatchedRef.resize();this._gridMatchedRef.resize();this._gridReviewedRef.resize()},
_generateDynamicColumns:function(a){var c=[],b,e;for(b=0;b<a.fields.length;b++)e=a.fields[b].name===this._test_addressKeyword?m({label:a.fields[b].name,field:a.fields[b].alias,editor:"text",editOn:"dblclick",autoSave:!0}):{label:a.fields[b].name,field:a.fields[b].alias,hidden:!0},a.fields[b].name===this._featureLayer.objectIdField?c.splice(0,0,{label:a.fields[b].name,field:a.fields[b].alias,hidden:!0}):c.push(e);return this._unmatchedColumns=c},_generateDefaultColumns:function(){this._unmatchedColumns=
[{label:"ID",field:"id"},{label:"Address",field:"address"}];this._matchedColumns=[{label:"ID",field:"id"},{label:"Address",field:"address"}];this._reviewedColumns=[{label:"ID",field:"id"},{label:"Old Address",field:"oldAddress"},{label:"New Address",field:"newAddress"}]},_generateStores:function(){this._unmatchedStore=new f({data:"",idProperty:this._idProperty});this._matchedStore=new f({data:"",idProperty:this._idProperty});this._reviewedArray=[];this._reviewedStore=new f({data:this._reviewedArray,
idProperty:this._idProperty})},destroy:function(){this._listenerHandles.forEach(function(a){a.remove()});this.map&&(this.map.infoWindow.clearFeatures(),this.map.infoWindow.hide(),this.map.removeLayer(this.graphicsLayer));this.map=this.graphicsLayer=null;this.inherited(arguments)}});t("extend-esri")&&b.setObject("dijit.GeocodeReview",h,H);return h});
//@ sourceMappingURL=GeocodeReview.js.map